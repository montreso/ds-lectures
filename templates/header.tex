\ifhandouts
\documentclass[handout,notes]{beamer}
\fi
\ifslides
\documentclass{beamer}
\fi
\ifnotes
\documentclass[handout,notes=onlyslideswithnotes]{beamer}
\fi

\usepackage{eurosym}
\usepackage{etex}
\usepackage{pgfpages}
\usepackage[utf8]{inputenc}
\usepackage{hyperref}
\usepackage{alltt}
\usepackage{color}
\usepackage{amsmath,amsfonts,amssymb,amsthm}
\usepackage[ruled,vlined,nofillcomment]{algorithm2e}
\usepackage{xspace}
\usepackage{templates/ds}
\usepackage[normalem]{ulem}
\usepackage{filemod}
\usepackage{bibentry}
\usepackage{multicol}
\usepackage{templates/spacetime}

\newcolumntype{P}[1]{>{\raggedright\arraybackslash}p{#1}}


\author{Alberto Montresor}
\institute[UniTN]{University of Trento, Italy}
\date{\filemodprintdate{\jobname.tex}}



\usetheme[secheader]{Boadilla}
\usecolortheme{beaver}
\usefonttheme{serif}

\colorlet{custom}{beamerstructure}
\setbeamertemplate{itemize subitem}{\tiny\raise1.5pt\hbox{\color{custom}$\blacktriangleright$}}
\setbeamertemplate{itemize subsubitem}{\tiny\raise1.5pt\hbox{\color{custom}$\bigstar$}}


\newcommand{\FrameTitle}[1]{
	{
	\setbeamertemplate{footline}{} 
	\setbeamertemplate{headline}{} 
	\begin{frame}[noframenumbering]
		\titlepage
		\medskip
		#1
		\begin{tabular}{@{\extracolsep{\fill}}  P{0.75\textwidth}  P{0.20\textwidth} }			
		\bigskip
		\href{http://creativecommons.org/licenses/by-sa/4.0/}{This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.} & 
		\bigskip
		\includegraphics[width=2.5cm]{figs/by-sa.pdf} 
		\end{tabular}
		
		\invisible{
		\nobibliography*{references}
		\bibliographystyle{abbrv}
		\bibliography{references}  
		}
	\end{frame}
	}
}

\newenvironment{PlainFrame}[2][shrink,noframenumbering]{
	\setbeamertemplate{headline}
	{
	  \leavevmode%
	  \hbox{%
	  \begin{beamercolorbox}[wd=1.0\paperwidth,ht=2.25ex,dp=2.25ex,center]{author in head/foot}%
	    \usebeamerfont{author in head/foot}~
	  \end{beamercolorbox}}%
	  \vskip0pt%
	}
	\setbeamertemplate{footline}
	{
	  \leavevmode%
	  \hbox{%
	  \begin{beamercolorbox}[wd=1.0\paperwidth,ht=2.25ex,dp=2.25ex,center]{author in head/foot}%
	    \usebeamerfont{author in head/foot}~
	  \end{beamercolorbox}}%
	  \vskip0pt%
	}
	\begin{frame}[#1]{#2}
}{
	\end{frame}
}


\newcommand{\FrameContent}{
	\begin{PlainFrame}{Contents}
		\bigskip
		\tableofcontents
	\end{PlainFrame}
}

\newenvironment{RMFrame}{
  \begin{PlainFrame}{Reading Material}
  \footnotesize
}{
  \end{PlainFrame}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\ifslides
\usepackage{pgfpages}
\AtBeginSection[]{
	{
	\setbeamertemplate{headline}
	{
	  \leavevmode%
	  \hbox{%
	  \begin{beamercolorbox}[wd=1.0\paperwidth,ht=2.25ex,dp=2.25ex,center]{author in head/foot}%
	    \usebeamerfont{author in head/foot}~
	  \end{beamercolorbox}}%
	  \vskip0pt%
	}
	\setbeamertemplate{footline}
	{
	  \leavevmode%
	  \hbox{%
	  \begin{beamercolorbox}[wd=1.0\paperwidth,ht=2.25ex,dp=2.25ex,center]{author in head/foot}%
	    \usebeamerfont{author in head/foot}~
	  \end{beamercolorbox}}%
	  \vskip0pt%
	}
	\begin{frame}<beamer>[shrink,noframenumbering]
		\frametitle{Contents}
		\bigskip
		\tableofcontents[currentsection]
	\end{frame}
	}
}
\fi
\ifnotes
\fi

\setbeamertemplate{navigation symbols}{}

\AtBeginNote
{
\footnotesize
}


\makeatletter
\defbeamertemplate{note page}{infolines}
{%
  {%
    \scriptsize
    \insertvrule{.25\paperheight}{white!90!black}
    \vskip-.25\paperheight
    \nointerlineskip
    \vbox{
      \hfill\insertslideintonotes{0.25}\hskip-\Gm@rmargin\hskip0pt%
      \vskip-0.25\paperheight%
      \nointerlineskip
      \begin{pgfpicture}{0cm}{0cm}{0cm}{0cm}
        \begin{pgflowlevelscope}{\pgftransformrotate{90}}
          {\pgftransformshift{\pgfpoint{-2cm}{0.2cm}}%
          \pgftext[base,left]{\footnotesize\the\year-\ifnum\month<10\relax0\fi\the\month-\ifnum\day<10\relax0\fi\the\day}}
        \end{pgflowlevelscope}
      \end{pgfpicture}}
    \nointerlineskip
    \vbox to .25\paperheight{\vskip0.5em
      \hbox{\insertshorttitle[width=8cm]}%
      \setbox\beamer@tempbox=\hbox{\insertsection}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsection\end{minipage}}\fi%
      }%
      \setbox\beamer@tempbox=\hbox{\insertsubsection}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip17.4pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\begin{minipage}[t]{7.5cm}\def\breakhere{}\insertsubsection\end{minipage}}\fi%
      }%
      \setbox\beamer@tempbox=\hbox{\insertshortframetitle}%
      \hbox{\ifdim\wd\beamer@tempbox>1pt{\hskip30.8pt\raise3pt\hbox{\vrule
            width0.4pt height7pt\vrule width 9pt
            height0.4pt}}\hskip1pt\hbox{\insertshortframetitle[width=7cm]}\fi%
      }%
      \vfil}%
  }%
  \vskip.25em
  \nointerlineskip
  \begin{minipage}{\textwidth} % this is an addition
  {\footnotesize \insertnote}
  \end{minipage}               % this is an addition
}
\makeatother

\setbeamertemplate{note page}[infolines]



